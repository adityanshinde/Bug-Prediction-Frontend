<div class="projects-page">
  @if (isLoading()) {
    <app-loader message="Loading projects..." />
  } @else if (error()) {
    <app-error-state [message]="error()!" (retry)="loadProjects()" />
  } @else {

  <!-- Projects Section -->
  <div class="projects-panel">
    <h2 class="section-title">Projects</h2>
    <div class="projects-list">
      @if (projects().length === 0) {
        <div class="empty-state-box">
          <i class="fas fa-folder-open"></i>
          <p>No projects available</p>
          <small>Add a new project to get started</small>
        </div>
      } @else {
        @for (project of projects(); track project.projectId) {
          <div class="project-card"
               [class.active]="selectedProject()?.projectId === project.projectId"
               (click)="selectProject(project)">
            <div class="project-icon">
              <i class="fas fa-shield-alt"></i>
            </div>
            <div class="project-info">
              <h3 class="project-name">{{ project.name }}</h3>
              <p class="project-url">{{ project.organization ?? project.projectKey }}</p>
              <p class="project-scan">Last Scan: {{ project.lastScanDate ?? 'N/A' }}</p>
            </div>
            <i class="fas fa-chevron-right arrow-icon"></i>
          </div>
        }
      }
    </div>
  </div>

  <!-- Scan History Section -->
  <div class="scan-history-panel">
    <h2 class="section-title">Scan History</h2>
    <div class="history-card">
      <h3 class="history-label">
        @if (selectedProject()) {
          {{ selectedProject()!.name }}
        } @else {
          Scan History
        }
      </h3>

      @if (historyLoading()) {
        <app-loader message="Loading scan history..." />
      } @else if (historyError()) {
        <app-error-state [message]="historyError()!" (retry)="loadScanHistory(selectedProject()!.projectId)" />
      } @else {
        <div class="table-wrapper">
          <table class="history-table">
            <thead>
              <tr>
                <th>Scan Date</th>
                <th>Branch</th>
                <th>Commit Hash</th>
                <th>Gate Status</th>
                <th>View Analysis</th>
              </tr>
            </thead>
            <tbody>
              @if (scanHistory().length === 0) {
                <tr>
                  <td colspan="5" class="empty-state">
                    <div class="empty-state-content">
                      <i class="fas fa-history"></i>
                      <p>No scan history available</p>
                    </div>
                  </td>
                </tr>
              } @else {
                @for (scan of scanHistory(); track scan.scanDate) {
                  <tr>
                    <td>{{ scan.scanDate }}</td>
                    <td>{{ scan.branch ?? 'N/A' }}</td>
                    <td><code>{{ (scan.commitId ?? 'N/A').substring(0, 8) }}</code></td>
                    <td>
                      <span class="badge"
                        [class.badge-success]="scan.qualityGateStatus === 'PASS'"
                        [class.badge-danger]="scan.qualityGateStatus === 'FAIL'">
                        {{ scan.qualityGateStatus ?? 'N/A' }}
                      </span>
                    </td>
                    <td><button class="btn-link">View Analysis</button></td>
                  </tr>
                }
              }
            </tbody>
          </table>
        </div>
      }
    </div>
  </div>

  } <!-- end @else -->
</div>
